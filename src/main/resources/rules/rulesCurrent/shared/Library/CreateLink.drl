package life.genny.rules;
import life.genny.rules.QRules;
import life.genny.qwanda.Link;

rule "Create Link"
	when
	    rules: QRules( isState("CREATE_LINK") && 
                        !isState("LOOP_CREATE_LINK") )   
	 then
	    rules.header();
		rules.setState("LOOP_CREATE_LINK");

        String sourceCode = rules.getAsString("sourceCode");
        String targetCode = rules.getAsString("targetCode");
        String linkCode = rules.getAsString("linkCode");
        String linkValue = rules.getAsString("linkValue");
        Double weight = rules.getAsDouble("weight");
 		
 		if (sourceCode == null) {
             rules.println("Create Link: missing sourceCode");
        }
        else if (targetCode == null) {
            rules.println("Create Link: missing targetCode");
        }
        else if (linkCode == null) {
            rules.println("Create Link: missing linkCode");
        }
        else if (linkValue == null) {
            rules.println("Create Link: missing linkValue");
        }
        else if (weight == null) {
            rules.println("Create Link: missing weight");
        }
        else {
            rules.createLink(sourceCode, targetCode, linkCode, linkValue, weight);	
                 
		    rules.setState("LINK_CREATED");	             
		    rules.setState(linkValue);	             
        }
	    rules.footer();      	
end
