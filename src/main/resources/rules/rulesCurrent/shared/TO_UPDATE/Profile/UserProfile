package life.genny.rules;

import life.genny.utils.RulesUtils;
import life.genny.rules.QRules;

import life.genny.qwanda.message.QEventMessage;

import java.util.List;

import life.genny.qwanda.entity.BaseEntity;

rule "User-Default-Profile"
    when
       m : QEventMessage( event_type == "PROFILE" && data.code == "PROFILE"  )
       rules: QRules( isState("STARTED") && !isState("PROFILE_RULE_EXECUTED") )
    then
        rules.header();
        
        rules.setState("PROFILE_RULE_EXECUTED");
        
        /* we get the project */
        BaseEntity project = rules.getProject();
        if (project != null) {
        
			/* we fetch the profile question group code from the project attribute.  */
			/* if it does not exist, we default it to the genny profile question group */
			
            String profileQuestionGroup = project.getValue(rules.loadUserRole()+"_PROFILE_GRP", "QUE_DEFAULT_PROFILE_GRP");
            rules.askQuestions(rules.getUser().getCode(), rules.getUser().getCode(), profileQuestionGroup, true);
        }

        rules.footer();
end