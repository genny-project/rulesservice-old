package life.genny.rules;

import life.genny.rules.QRules;
import life.genny.qwanda.entity.BaseEntity;
import life.genny.utils.VertxUtils;
import life.genny.qwandautils.JsonUtils;
import life.genny.qwanda.message.QDataBaseEntityMessage;

rule "Send Roles"
    when
         rules: QRules( isState("SEND_ROLES") && !isState("SENT_ROLES") )
     then
     	rules.header();

        rules.setState("SENT_ROLES");

     	/* send company roles */
        BaseEntity userCompany = rules.getUserCompany();
        if(userCompany != null) {
        	
	        	List<BaseEntity> companyRoles = rules.baseEntity.getLinkedBaseEntities(userCompany.getCode(), "LNK_ROLE");
	    		if(companyRoles != null) {

	    			/* publishing */
	    			rules.publishCmd(companyRoles, "GRP_ROLES", "LNK_ROLE");
	    		}
        }
        
        rules.setState("SEND_PROJECT");

	    rules.footer();      		      
end
