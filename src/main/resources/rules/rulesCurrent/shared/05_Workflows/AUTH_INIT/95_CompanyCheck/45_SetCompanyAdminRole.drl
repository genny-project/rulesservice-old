package life.genny.rules;

import life.genny.rules.QRules;
import java.util.List;

rule "Check user company - Step 3.5"
     when
     	rules: QRules( 	isState("SET_COMPANY_ADMIN_ROLE") && !isState("DID_SET_COMPANY_ADMIN_ROLE") ) 
     then      
        rules.header();     

		rules.setState("DID_SET_COMPANY_ADMIN_ROLE");
		
		BaseEntity companyBe = rules.getAsBaseEntity("baseEntity");	
		
		BaseEntity adminRole = rules.baseEntity.createRole("COMPANY_ADMIN", "Company Admin", "CAP_ADD_CHAT_MESSAGE","CAP_UPDATE_CHAT_MESSAGE", "CAP_ADD_ITEM", "CAP_MARK_DELIVERY");

		/* we attach the role to the company */
		rules.baseEntity.setRole(companyBe, adminRole);
		
		/* we attach the role to the user */
		rules.baseEntity.setRole(rules.getUser(), adminRole);

		rules.setState("COMPANY_EXISTS");

		rules.footer();     		      
end
     	