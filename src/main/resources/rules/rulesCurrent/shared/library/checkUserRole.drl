package life.genny.rules;

import life.genny.rules.QRules;
import java.util.List;

rule "Check User Role"
     when
        rules: QRules( (isState("USER_CHECKED") || isState("STARTED")) && isState("CHECK_ROLE") && !isState("ROLE_IS_CHECKED") ) 
     then
        rules.header();
        
		rules.setState("ROLE_IS_CHECKED");
		
		Object[] roleCodes = rules.getAsArray("roleCodes");
		
		Boolean found = false;
		
		rules.println(roleCodes.toString());
		if(roleCodes.length > 0) {
			for(Object roleCodeObj: roleCodes) {			
				if(roleCodeObj != null) {
				
					String roleCode = (String)roleCodeObj;
					Boolean userRole = rules.getUser().getValue(roleCode, false);
					rules.println("====================");
					rules.println("Checking for role: " + roleCode);
					rules.println(userRole);
					
					if(userRole != null && userRole == true) {
						rules.setState(roleCode);
						found  = true;
					}
				}
			}
		}
		
		if(found == false) {
			rules.setState("ROLE_NOT_FOUND");
		}else{
			rules.setState("ROLE_FOUND");
		}
	    rules.footer();     		      
end
